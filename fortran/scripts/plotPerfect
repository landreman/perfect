#!/usr/bin/env python

import matplotlib.pyplot as plt
import numpy
import h5py
import inspect, os

filename = 'PERFECTOutput.h5'

try:
    f = h5py.File(filename,'r')
except:
    print "ERROR! Unable to open file "+filename+" in the current directory."
    raise

for runNum in range(1,10):
    location = '/run{:3d}/'.format(runNum)
    try:
        psi = f[location+'psi'][()]
    except:
        # This run number does not exist in the output file.
        break

    print "Reading run ",runNum
    fig = plt.figure()
    fig.patch.set_facecolor('white')
    plotNum = 1

    numRows = 3
    numCols = 4

    #print location

    nHat = f[location+'nHat'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,nHat,'.-')
    plt.xlabel('psi')
    plt.ylabel('nHat')

    THat = f[location+'THat'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,THat,'.-')
    plt.xlabel('psi')
    plt.ylabel('THat')

    PhiHat = f[location+'PhiHat'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,PhiHat,'.-')
    plt.xlabel('psi')
    plt.ylabel('PhiHat')

    U = f[location+'U'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,U,'.-')
    plt.xlabel('psi')
    plt.ylabel('U')

    etaHat = f[location+'etaHat'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,etaHat,'.-')
    plt.xlabel('psi')
    plt.ylabel('etaHat')

    FSAKPar = f[location+'FSAKPar'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,FSAKPar,'.-')
    plt.xlabel('psi')
    plt.ylabel('FSAKPar')

    particleFlux = f[location+'particleFlux'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,particleFlux,'.-')
    plt.xlabel('psi')
    plt.ylabel('particleFlux')

    heatFlux = f[location+'heatFlux'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,heatFlux,'.-')
    plt.xlabel('psi')
    plt.ylabel('heatFlux')

    particleSourceProfile = f[location+'particleSourceProfile'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,particleSourceProfile,'.-')
    plt.xlabel('psi')
    plt.ylabel('particleSourceProfile')

    heatSourceProfile = f[location+'heatSourceProfile'][()]
    plt.subplot(numRows,numCols,plotNum); plotNum += 1
    plt.plot(psi,heatSourceProfile,'.-')
    plt.xlabel('psi')
    plt.ylabel('heatSourceProfile')

    plt.tight_layout()

    ax = fig.add_axes([0,0,1,1], frameon=False)

    titleString = "Run "+str(runNum)
    ax.text(0.5,0.99,titleString,horizontalalignment='center',verticalalignment='top')

    titleString = "Plot generated by "+ inspect.getfile(inspect.currentframe()) + ", run in "+os.getcwd()
    ax.text(0.5,0.01,titleString,horizontalalignment='center',verticalalignment='bottom')

plt.savefig("perfect_plots.pdf")
plt.show()
